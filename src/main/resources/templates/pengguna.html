<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Manajemen Pengguna</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Manajemen Pengguna</h1>

        <!-- Form Tambah/Edit Pengguna -->
        <form id="penggunaForm">
            <div class="mb-3">
                <label for="nmPengguna" class="form-label">Nama Pengguna</label>
                <input type="text" class="form-control" id="nmPengguna" name="nmPengguna" required>
            </div>
            <div class="mb-3">
                <label for="user" class="form-label">Username</label>
                <input type="text" class="form-control" id="user" name="user" required>
            </div>
            <div class="mb-3">
                <label for="pass" class="form-label">Password</label>
                <input type="password" class="form-control" id="pass" name="pass" required>
            </div>
            <div class="mb-3">
                <label for="level" class="form-label">Level</label>
                <input type="text" class="form-control" id="level" name="level" required>
            </div>
            <button type="submit" class="btn btn-primary">Simpan</button>
        </form>

        <!-- Tabel Data Pengguna -->
        <table class="table mt-5">
            <thead>
                <tr>
                    <th>Nama Pengguna</th>
                    <th>Username</th>
                    <th>Level</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="penggunaTable">
                <!-- Data pengguna akan dimuat di sini -->
            </tbody>
        </table>
    </div>

    <script>
        // Fungsi untuk memuat data pengguna
        function loadPengguna() {
            $.get('/api/pengguna', function(data) {
                let rows = '';
                data.forEach(pengguna => {
                    rows += `
                        <tr>
                            <td>${pengguna.namaPengguna}</td>
                            <td>${pengguna.username}</td>
                            <td>${pengguna.level}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="editPengguna('${pengguna.idPengguna}')">Edit</button>
                                <button class="btn btn-danger btn-sm" onclick="deletePengguna('${pengguna.idPengguna}')">Hapus</button>
                            </td>
                        </tr>
                    `;
                });
                $('#penggunaTable').html(rows);
            });
        }

        // Fungsi untuk menyimpan pengguna (tambah/edit)
        $('#penggunaForm').submit(function(e) {
            e.preventDefault();
            const pengguna = {
                namaPengguna: $('#nmPengguna').val(),
                username: $('#user').val(),
                password: $('#pass').val(),
                level: $('#level').val()
            };
            console.log(pengguna, "pengguna");


            $.ajax({
                url: '/api/pengguna',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(pengguna),
                success: function() {
                    loadPengguna();
                    $('#penggunaForm')[0].reset();
                }
            });
        });

        // Fungsi untuk menghapus pengguna
        function deletePengguna(id) {
            if (confirm('Yakin ingin menghapus pengguna ini?')) {
                $.ajax({
                    url: `/api/pengguna/${id}`,
                    method: 'DELETE',
                    success: function() {
                        loadPengguna();
                    }
                });
            }
        }

        // Muat data pengguna saat halaman selesai dimuat
        $(document).ready(function() {
            loadPengguna();
        });
    </script>
</body>
</html>
